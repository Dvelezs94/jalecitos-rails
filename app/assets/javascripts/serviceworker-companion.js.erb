$(document).on('turbolinks:load', function() {
  const messaging = firebase.messaging();
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/firebase-messaging-sw.js.erb', {scope: './'})
      .then(registration => {
        console.log("registered Firebase SW");
      }).catch(err => console.log("Could not register firebase SW", err));
  }

  // on foreground message
  // messaging.onMessage(function(payload) {
  //   console.log('Message received. ', payload);
  // });

  // token refresh
  messaging.onTokenRefresh(function() {
    messaging.getToken().then(function(refreshedToken) {
        const currentTokenKey = { auth_key: refreshedToken }
        fetchSubscription(currentTokenKey);
    }).catch(function(err) {
    });
  });
});
