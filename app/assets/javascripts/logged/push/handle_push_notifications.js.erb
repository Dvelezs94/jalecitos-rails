function enableNotifications(subscription){
  if (!("Notification" in window)) {
    console.error("Tu navegador no soporta notificaciones");
  }

  // Let's check whether notification permissions have already been granted
  else if (Notification.permission === "granted") {
    new Notification("Tienes notificaciones habilitadas");
  }

  // Otherwise, we need to ask the user for permission
  else if (Notification.permission !== "denied") {
    Notification.requestPermission(function (permission) {
      // If the user accepts, let's create a notification
      if (permission == "granted") {
        <% @key = Base64.urlsafe_decode64(ENV.fetch('VAPID_PUBLIC_KEY')).bytes %>
        const vapidPublicKey = new Uint8Array(<%= @key %>)

        navigator.serviceWorker.ready
          .then(function(registration) {
            console.log('Successfully registered!', ':^)');
            return registration.pushManager.subscribe({
              userVisibleOnly: true,
              applicationServerKey: vapidPublicKey
            })
            .then( res => res.toJSON() )
            .then( subscription => {
              fetch("/subscribe", {
                method: "POST",
                headers: { 'Content-Type' : 'application/json'},
                body: JSON.stringify(subscription)
              });
            })
           .then( new Notification("Ahora estaras al tanto de tus jales!"))
          });
        }
     });
   }
 }
