<% name = (params[:gigs].present?)? "gig" : "request" %>
paginator_container = $('.paginated-'+'<%= j name %>'+"s").closest(".paginator-container");
<% if params[:by_city] == "true" %>
  <% collection = instance_variable_get("@"+name+"s") %>
  $(".paginated-"+'<%= j name %>'+"s").append('<%= j render(partial: "shared/queries/#{name}", collection: collection) %>');
<% end %>
<% if params[:city_last_page] == "true" || params[:state_id].present?%>
  <% collection_by_state = instance_variable_get("@"+name+"s_by_state") %>
  $(".paginated-"+'<%= j name %>'+"s").append('<%= j render(partial: "shared/queries/#{name}", collection: collection_by_state) %>');
<% end %>
paginator_container.find('.pag-and-load').remove();

<% if collection.next_page %>
  paginator_container.append("<%= j paginate(collection, param_name: name+'s', params: { city_last_page: (collection.total_pages - collection.current_page) == 1, by_city: true }) %>");
<% elsif params[:city_last_page] == true && params[:city_id].present? %>
  paginator_container.append("<%= j paginate(collection_by_state, param_name: name+'s_by_state', params: { last_page: (collection.total_pages - collection.current_page) == 1 }) %>");
<% elsif  %>
<% end %>


<% sleep 1 %>
