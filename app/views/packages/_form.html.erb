<%= form_with(model: package, url: package_form_url_helper, method: form_method_helper, local: true, :html => { :id => "packages_form", class: "current_form" }) do |form|%>
<div class="container-fluid section centered-form packages-builder">
  <h3 id="how-many-pack">Define tus paquetes</h3>
  <div class="col-lg-8 mar-0-auto">
    <nav class="pack-names">
      <div class="nav nav-tabs" id="nav-tab" role="tablist">
        <a class="nav-item nav-link package-nav active" id="pack-tab-0" data-toggle="tab" href="#package-0" role="tab" aria-selected="true">Básico</a>
        <a class="nav-item nav-link package-nav" id="pack-tab-1" data-toggle="tab" href="#package-1" role="tab" aria-selected="false" style="<%= "display:none;" if params[:action] == 'new' || @gig.packages[1].name == "" %>">Éstandar</a>
        <a class="nav-item nav-link package-nav" id="pack-tab-2" data-toggle="tab" href="#package-2" role="tab" aria-selected="false" style="<%= "display:none;" if params[:action] == 'new' || @gig.packages[2].name == "" %>">Premium</a>
        <a href="#" class="pack-tab-displayer" style="<%= "display:none;" if params[:action] == 'edit_packages' && @gig.packages[2].name != '' %>"><%= icon("fas", "plus") %></a>
      </div>
    </nav>
    <div class="tab-content" id="nav-tabContent">
      <% package.each_with_index do |pack, n| %>
        <div class="tab-pane fade <%= " show active" if n==0 %>" id="package-<%= n %>" role="tabpanel" aria-labelledby="pack-tab-<%= n %>">

          <div class="form_box pack_form_col">
            <% if pack.errors.any? %>
              <%pack.errors.full_messages.each do |error| %>
                <%= notification_generator_helper error, :error %>
              <% end %>
            <% end %>

            <%= fields_for 'packages[]', pack do |pa| %>

            <div class="form-block form-group-<%= n %> row col-lg-11 centered-form">
              <strong class="form-title">Nombre del paquete</strong>
              <%= pa.text_field :name, class: "name-class name-#{n} form_fields_#{n} styled",maxlength: 100, placeholder: "Fotos tamaño infantil" %>
              <span class="error error_span_<%= 3*n+1 %>"></span>
            </div>

            <hr>
            <div class="form-block form-group-<%= n %> row col-lg-11 centered-form">
              <div class="flex-space-bet">
                <p class="form-title">Lo que realizaré:</p>
              </div>

                 <%= pa.text_area :description, id: "description#{n}", maxlength: 1000,
                 placeholder: "5 fotos tamaño infantil a color",
                 class: "description-class description-#{n} form_fields_#{n} styled required", rows: 5 %>

              <span class="error error_span_<%= 3*n+2 %>"></span>
            </div>
            <hr>

            <div class="form-block form-group-<%= n %> pack-price-class row col-lg-11 centered-form">

              <div class="row will-earn justify-content-center col-lg-6 col-md-6 col-sm-12 col-12">
                <p class="price-text form-title">Lo que ganaré:</p>
                <div class="row justify-content-center w-100">
                  <%= icon "fas","dollar", class: "fa-2x", id: "price-symbol" %>
                  <input type="number" name="want_win_<%= n %>" min="100" max="9000" step=".01"
                   class="price-input price-input-<%= n %> form-control"
                   value="<%= (@gig.packages[n].price).round(2) if params[:action] == 'edit_packages' && @gig.packages[n].price.present? %>">
                  <%= pa.hidden_field :price, id: "base-price-#{n}", class: "form_fields_#{n}" %>
                  <span class="error error_span_<%= 3*n+3 %>"></span>
                  </div>
                </div>
                <div class=" form_block row will-show col-lg-6 col-md-6 col-sm-12 col-12">
                  <div class="flex-space-bet">
                    <p class="price-text form-title">Precio final:  <%= icon("fas", "question-circle", class: "question_hint toggler") %></p>
                  </div>
                  <%= render 'shared_user/pack/hints/price_hint.html.erb' %>
                  <label id="price-calc-<%= n %>" class="label-price"></label>
                </div>
              <p class="text-center mar-0-auto" style="color: var(--gray);">Se te cobrará un porcentaje de tus ganancias de acuerdo a tu nivel</p>  
              </div>
              <div style="margin:0 20px;display:flex;justify-content:flex-end;">
                <%=link_to icon("fas", "trash-alt", class: "fa-2x", style: "color: red;"), "#{n}", class: "erase-all" %>
              </div>
            <% end %>
          </div>

        </div>
        <% n += 1  %><% end %>

        <div class="form-group submit-button submit-pack-buttons">
          <%= link_to 'Cancelar', user_path(current_user.slug), :data => {:confirm => 'Tu jale se ha guardado, pero tus paquetes NO'}, class: "btn back-button" %>
          <%= form.submit "Publicar", class: "btn continue-button" %>
        </div>
        <div class="error error-messages"></div>

      </div>
    </div>
  </div>

<% end %>
