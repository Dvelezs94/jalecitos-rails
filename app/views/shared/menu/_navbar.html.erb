<% categories = Category.all %>
<% group_size = (categories.length%3 != 0)? (categories.length/3+1).to_i : (categories.length/3).to_i %>
<header class="navbar navbar-header navbar-header-fixed">
  <a href="" id="mainMenuOpen" class="burger-menu"><i data-feather="menu"></i></a>
  <a href="" id="chatContentClose" class="burger-menu d-none"><i data-feather="arrow-left"></i></a>
  <div class="navbar-brand">
    <%= link_to root_path, class: "df-logo" do  %>
      Jale<span>citos</span>
    <% end %>
  </div><!-- navbar-brand -->
  <div id="navbarMenu" class="navbar-menu-wrapper">
    <div class="navbar-menu-header">
      <a href="base/template/index.html" class="df-logo">Jale<span>citos</span></a>
      <a id="mainMenuClose" href=""><i data-feather="x"></i></a>
    </div><!-- navbar-menu-header -->
    <ul class="nav navbar-menu justify-content-center">
      <li class="nav-label pd-l-20 pd-lg-l-25 d-lg-none">Menu</li>
      <% if current_user %>
      <li class="nav-item with-sub active">
        <a href="" class="nav-link"><i data-feather="briefcase"></i> Servicios</a>
        <ul class="navbar-menu-sub">
          <li class="nav-sub-item">
            <%= link_to new_gig_path, class: "nav-sub-link" do  %>
              <i data-feather="bar-chart-2"></i>Nuevo Servicio
            <% end %>
          </li>
          <li class="nav-sub-item">
            <%= link_to my_account_users_path, class: "nav-sub-link" do  %>
              <i data-feather="users"></i>Mis Servicios
            <% end %>
          </li>
          <li class="nav-sub-item">
            <%= link_to likes_path, class: "nav-sub-link" do  %>
              <i data-feather="heart"></i>Gustados
            <% end %>
          </li>
        </ul>
      </li>
      <li class="nav-item with-sub">
        <a href="" class="nav-link"><i data-feather="package"></i> Pedidos</a>
        <ul class="navbar-menu-sub">
          <li class="nav-sub-item">
            <%= link_to new_request_path, class: "nav-sub-link" do  %>
              <i data-feather="bar-chart-2"></i>Nuevo Pedido
            <% end %>
          </li>
          <li class="nav-sub-item">
            <%= link_to my_account_users_path, class: "nav-sub-link" do  %>
              <i data-feather="users"></i>Mis Pedidos
            <% end %>
          </li>
        </ul>
      </li>
      <% else %>
      <li class="nav-item with-sub active">
        <a href="" class="nav-link"><i data-feather="briefcase"></i> Cuenta</a>
        <ul class="navbar-menu-sub">
          <li class="nav-sub-item">
            <%= link_to new_user_session_path, class: "nav-sub-link" do  %>
              <i data-feather="user-check"></i>Iniciar Sesión
            <% end %>
          </li>
          <li class="nav-sub-item">
            <%= link_to new_user_registration_path, class: "nav-sub-link" do  %>
              <i data-feather="user-plus"></i>Registrarme
            <% end %>
          </li>
        </ul>
      </li>
      <% end %>
      <li class="nav-item with-sub">
        <a href="" class="nav-link"><i data-feather="layers"></i> Categorías</a>
        <div class="navbar-menu-sub">
          <div class="d-lg-flex">
              <% 3.times do |n| %>
                <ul>
                  <% categories.in_groups_of(group_size)[n].each do |cat| %>
                    <% if cat.present? %>
                    <li class="nav-sub-item">
                      <%= link_to search_path(query: "", category_id: cat.id, lat: @mylat, lng: @mylng), class: "nav-sub-link" do %>
                        <%= cat.name %>
                      <% end %>
                    </li>
                    <% end %>
                  <% end %>
                  </ul>
              <% end %>
          </div>
        </div><!-- nav-sub -->
      </li>
      <li class="nav-item"><a href="" class="link-04 nav-link" id="invite-friend"><i data-feather="share-2"></i>Invitar</a></li>
      <hr class="d-lg-none mg-r-5 mg-l-5">
      <% if current_user %>
      <div class="location-header">
        <li class="nav-item">
         <%= form_with model: User, url: update_users_path, method: :put , remote: true do |f|%>
            <%= f.text_field :location, class: 'form-control rounded', id: "menu_autocomplete", placeholder: "Ubicación",
            value: (current_user.location(true).present?)? current_user.location : "",
            lat: (params[:location].present?)? params[:lat] : current_user.lat || nil,
            lng: (params[:location].present?)? params[:lng] : current_user.lng || nil %>
            <%= f.submit("Enviar", class: "d-none") %>
          <% end %>
        </li>
      </div>
      <% end %>
    </ul>

  </div><!-- navbar-menu-wrapper -->
  <div class="navbar-right">
    <%= link_to "", class: "search-link", id: "navbarSearch" do  %>
      <i data-feather="search"></i>
    <% end %>
    <% if current_user %>
    <div class="dropdown dropdown-message">
      <a href="" class="dropdown-link new-indicator" data-toggle="dropdown">
        <i data-feather="message-square"></i>
        <span class="d-none" new-message></span><!-- -->
      </a>
      <div class="dropdown-menu dropdown-menu-right">
        <div class="dropdown-header" new-messages>Últimos mensajes</div>
        <!-- message content loaded by ajax -->
      <span class="container" no-messages>Nada para mostrar</span>

        <div class="dropdown-footer"><a href="<%= conversations_path %>">Ver todos los mensajes</a></div>
      </div><!-- dropdown-menu -->
    </div><!-- dropdown -->
    <div class="dropdown dropdown-notification">
      <a href="" class="dropdown-link new-indicator" data-toggle="dropdown" read-notifications>
        <i data-feather="bell"></i>
        <span class="d-none"></span>
      </a>
      <div class="dropdown-menu dropdown-menu-right">
        <div class="dropdown-header" notifications>Notificaciones</div>
        <!-- notification content -->

        <div class="dropdown-footer"><a href="<%= all_notifications_path %>">Ver todas las notificaciones</a> </div>
      </div><!-- dropdown-menu -->
    </div><!-- dropdown -->
    <div class="dropdown dropdown-profile">
      <a href="" class="dropdown-link" data-toggle="dropdown" data-display="static">
        <div class="avatar avatar-sm">
          <%= image_tag(avatar_display_helper(current_user.image_url(:thumb)), class: "rounded-circle", lazy: true) %>
        </div>
      </a><!-- dropdown-link -->
      <div class="dropdown-menu dropdown-menu-right tx-13">
        <div class="avatar avatar-lg mg-b-15">
          <%= image_tag(avatar_display_helper(current_user.image_url(:thumb)), class: "rounded-circle") %>
        </div>
        <h6 class="tx-semibold mg-b-25"><%= current_user.name %></h6>
        <%= link_to my_account_users_path, class: "dropdown-item" do  %>
          <i data-feather="user"></i>Mi perfil
        <% end %>
        <%= link_to configuration_path, class: "dropdown-item" do  %>
          <i data-feather="settings"></i>Configuración
        <% end %>
        <hr>
        <!-- <a href="page-help-center.html" class="dropdown-item"><i data-feather="help-circle"></i> Ayuda</a> -->
        <%= link_to destroy_user_session_path(device: "pending"), method: :delete, class: "dropdown-item" do  %>
          <i data-feather="log-out"></i>Cerrar sesión
        <% end %>
      </div><!-- dropdown-menu -->
    </div><!-- dropdown -->
    <% end %>
  </div><!-- navbar-right -->
  <div class="navbar-search">
    <%= form_with url: search_path, method: :get ,:html => {id: "simple-query"}, local: true do |f|%>
    <div class="navbar-search-header">
      <%= f.search_field :query, value: params[:query], class:"form-control", placeholder: "Escribe y presiona Enter para buscar", autocomplete: "off" %><%# la clase ahead query pondria el autocomplete  %>
      <button class="btn"><i data-feather="search"></i></button>
      <a id="navbarSearchClose" href="" class="link-03 mg-l-5 mg-lg-l-10"><i data-feather="x"></i></a>
    </div><!-- navbar-search-header -->
    <% end %>
    <div class="navbar-search-body">
      <label class="tx-10 tx-medium tx-uppercase tx-spacing-1 tx-color-03 mg-b-10 d-flex align-items-center">Búsquedas recientes</label>
      <ul class="list-unstyled">
        <li><a href="dashboard-one.html">modern dashboard</a></li>
        <li><a href="app-calendar.html">calendar app</a></li>
        <li><a href="base/template/collections/modal.html">modal examples</a></li>
        <li><a href="base/template/components/el-avatar.html">avatar</a></li>
      </ul>

      <hr class="mg-y-30 bd-0">

      <label class="tx-10 tx-medium tx-uppercase tx-spacing-1 tx-color-03 mg-b-10 d-flex align-items-center">Search Suggestions</label>

      <ul class="list-unstyled">
        <li><a href="dashboard-one.html">cryptocurrency</a></li>
        <li><a href="app-calendar.html">button groups</a></li>
        <li><a href="base/template/collections/modal.html">form elements</a></li>
        <li><a href="base/template/components/el-avatar.html">contact app</a></li>
      </ul>
    </div><!-- navbar-search-body -->
  </div><!-- navbar-search -->
</header><!-- navbar -->
